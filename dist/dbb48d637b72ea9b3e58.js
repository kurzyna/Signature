var _display_name,_job_title,_phone_number,_email_id,_department_name,_team_name,_message;function on_initialization_complete(){$(document).ready((function(){_output=$("textarea#output"),_display_name=$("input#display_name"),_email_id=$("input#email_id"),_job_title=$("input#job_title"),_phone_number=$("input#phone_number"),_department_name=$("input#department_name"),_team_name=$("input#team_name"),_message=$("p#message"),prepopulate_from_userprofile(),load_saved_user_info()}))}function prepopulate_from_userprofile(){var e=Office.context.mailbox.userProfile||{},a=(e.displayName||"").trim().replace(/\s+/g," "),i=a.split(" ").filter(Boolean),t=a;if(i.length>=2){var n=i[i.length-1],o=i.slice(0,-1).join(" ");t="".concat(n," ").concat(o)}_display_name.val(t),_email_id.val(e.emailAddress||"")}function load_saved_user_info(){var e=localStorage.getItem("user_info");if(e||(e=Office.context.roamingSettings.get("user_info")),e){var a=JSON.parse(e);_display_name.val(a.name),_email_id.val(a.email),_job_title.val(a.job),_phone_number.val(a.phone),_department_name.val(a.department),_team_name.val(a.team)}}function display_message(e){_message.text(e)}function clear_message(){_message.text("")}function is_not_valid_text(e){return e.length<=0}function is_not_valid_email_address(e){return is_not_valid_text(e)||!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(e)}function form_has_valid_data(e,a){return is_not_valid_text(e)?(display_message("Proszę podać prawidłowe imię i nazwisko."),!1):!is_not_valid_email_address(a)||(display_message("Proszę podać prawidłowy adres email."),!1)}function navigate_to_taskpane_assignsignature(){window.location.href="assignsignature.html"}function showFieldError(e,a){clearFieldError(e),e.addClass("invalid"),e.after('<div class="error-msg">'+a+"</div>")}function clearFieldError(e){e.removeClass("invalid");var a=e.next(".error-msg");a.length&&a.remove()}function validate_form_fields(){var e=!0,a=_display_name,i=_email_id,t=_job_title;[a,i,t].forEach(clearFieldError);var n=(a.val()||"").trim(),o=(i.val()||"").trim(),r=(t.val()||"").trim();return n||(showFieldError(a,"Podaj imię i nazwisko."),e=!1),o&&/^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/i.test(o)||(showFieldError(i,"Podaj poprawny adres e-mail."),e=!1),r||(showFieldError(t,"Podaj stanowisko."),e=!1),e?$("#message").hide():$("#message").text("Uzupełnij brakujące pola.").show(),e}function create_user_info(){if(clear_message(),validate_form_fields()){var e={name:_display_name.val().trim(),email:_email_id.val().trim(),job:_job_title.val().trim(),phone:_phone_number.val().trim(),department:_department_name.val().trim(),team:_team_name.val().trim()};localStorage.setItem("user_info",JSON.stringify(e)),navigate_to_taskpane_assignsignature()}}function clear_all_fields(){_display_name.val(""),_email_id.val(""),_phone_number.val(""),_job_title.val(""),_department_name.val(""),_team_name.val("")}function clear_all_localstorage_data(){localStorage.removeItem("user_info"),localStorage.removeItem("newMail"),localStorage.removeItem("reply"),localStorage.removeItem("forward"),localStorage.removeItem("override_olk_signature")}function clear_roaming_settings(){Office.context.roamingSettings.remove("user_info"),Office.context.roamingSettings.remove("newMail"),Office.context.roamingSettings.remove("reply"),Office.context.roamingSettings.remove("forward"),Office.context.roamingSettings.remove("override_olk_signature"),Office.context.roamingSettings.saveAsync((function(e){console.log("clear_roaming_settings - "+JSON.stringify(e));var a="Wszystkie ustawienia zostały pomyślnie zresetowane! Ten dodatek nie będzie już wstawiać żadnych podpisów. Możesz teraz zamknąć to okno.";e.status===Office.AsyncResultStatus.Failed&&(a="Reset nie powiódł się. Spróbuj ponownie."),display_message(a)}))}function reset_all_configuration(){clear_all_fields(),clear_all_localstorage_data(),clear_roaming_settings()}Office.initialize=function(e){on_initialization_complete()},$(document).on("input","#display_name, #email_id, #job_title",(function(){clearFieldError($(this)),$("#message").hide()}));